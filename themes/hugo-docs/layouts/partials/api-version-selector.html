{{ $page := .page }}
{{ $endpoint := .endpoint }}
{{ $currentVersion := .version }}

{{ $versionedEndpoints := where (hugo.Store.Get "api-endpoints") "endpointId" "eq" $endpoint.endpointId }}
{{ if gt (len $versionedEndpoints) 1 }}
  <select
    class="api-example__version-selector"
    name="version"
    onchange="window.location.href = `?version=${this.value}`"
  >
    {{ $versions := slice }}
    {{ range $versionedEndpoints }}
      {{ $versions = $versions | append (partial "api-version-object" (dict "page" $page "endpoint" .)) }}
    {{ end }}

    {{ range $v := sort $versions "sequence" "desc" }}
      <option
        value="{{ $v.version }}"
        {{ if eq $currentVersion $v.version }}selected{{ end }}
      >
        {{ $v.version }}
      </option>
    {{ end }}
  </select>
{{ end }}
